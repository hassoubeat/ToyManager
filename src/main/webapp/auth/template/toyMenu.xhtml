<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:p="http://primefaces.org/ui">
    <body>
        <ui:composition>
            <ui:repeat var="item" value="#{toyMenuBean.toyList}" varStatus="status">
                <div class="panel panel-primary" id="toy-item-#{item.id}" style="margin-right: -15px; margin-bottom: 1px;">
                    <div class="panel-heading">
                        Toy_#{status.index + 1}
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <img class="thumnail_50" src="#{appPropetiesBean.HOST_PATH}ToyManager/resources/img/toymanager.png" style="margin-left: 5px;"/>
<!--                            <img class="thumnail_50" src="#{item.pictureUrl}" style="margin-left: 5px;"/>-->
                            <b>#{item.name}</b>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th style="text-align: center;">最後の同期時刻</th>
                                    <!-- TODO 差分イベント同期機能が実装された際に解禁 -->
<!--                                    <th>同期状態</th>-->
                                </tr>
                            </thead>
                            <tbody class="text-center">
                                <tr>
                                    <td>
                                        <ui:fragment  rendered="#{item.lastSyncDate != null}">
                                            <!-- 最終同期時刻が存在した場合 -->
                                            <h:outputText class="label label-success" value="#{item.lastSyncDate}" >
                                                <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
                                            </h:outputText>
                                        </ui:fragment>
                                        <ui:fragment  rendered="#{item.lastSyncDate == null}">
                                            <!-- 最終同期時刻が存在しなかった場合(一度も同期したことがなかった場合) -->
                                            <label class="label label-default">
                                                no data
                                            </label>
                                        </ui:fragment>
                                    </td>
                                    <!-- TODO 差分イベント同期機能が実装された際に解禁 -->
<!--                                    <td>
                                        <ui:fragment  rendered="#{item.diffSyncEventList.size() == 0}">
                                            <label class="label label-success">
                                                 未同期のイベントが存在しない場合 
                                                sync
                                            </label>
                                        </ui:fragment>
                                        <ui:fragment  rendered="#{item.diffSyncEventList.size() > 0}">
                                            <label class="label label-danger">
                                                 未同期のイベントが一件以上存在した場合 
                                                unsync
                                            </label>
                                        </ui:fragment>
                                    </td>-->
                                </tr>
                            </tbody>
                        </table>
                        
                        
                        <form jsf:id="toy-select-form" id="toy-select-form-#{item.id}" style="display: inline;">
                            <button class="btn btn-success" id="select-toy-#{item.id}" jsf:action="#{toyMenuBean.selectToy(item.id)}" style="margin-right: 5px;">選択</button>
                        </form>
                        <!-- 未承認のアクセスフィルターがあった場合表示する -->
                        <ui:fragment  rendered="#{utilLogicBean.isExistUnapprovedAccess(item)}">
                            <ui:fragment rendered="#{sessionBean.selectedToyId == item.id}">
                                <div class="pull-right"><span class="label label-warning"><a jsf:outcome="/auth/toy/status"><span class="glyphicon glyphicon-alert"/>　未承認のToyからアクセスがあります。</a></span></div>
                            </ui:fragment>
                            <ui:fragment rendered="#{sessionBean.selectedToyId != item.id}">
                                <div class="pull-right"><span class="label label-warning"><span class="glyphicon glyphicon-alert"/>　未承認のToyからアクセスがあります。</span></div>
                            </ui:fragment>
                        </ui:fragment>
                        <!-- アクセストークンの有効期限が切れていた場合表示する -->
                        <ui:fragment  rendered="#{utilLogicBean.isExistAccessTokenExpired(item)}">
                            <ui:fragment rendered="#{sessionBean.selectedToyId == item.id}">
                                <div class="pull-right"><span class="label label-danger"><a jsf:outcome="/auth/toy/status"><span class="glyphicon glyphicon-alert"/>　アクセストークンの有効期限が切れています。</a></span></div>
                            </ui:fragment>
                            <ui:fragment rendered="#{sessionBean.selectedToyId != item.id}">
                                <div class="pull-right"><span class="label label-danger"><span class="glyphicon glyphicon-alert"/>　アクセストークンの有効期限が切れています。</span></div>
                            </ui:fragment>
                        </ui:fragment>
                    </div>
                </div>
            </ui:repeat>
            
            <a jsf:outcome="/auth/toy/create" style="text-decoration:none;">
                <div class="panel panel-default" id="toy-item-register" style="margin-right: -15px; margin-bottom: 1px;">
                    <div class="panel-body" style="border-color: #585858; border-style: dotted; text-align: center;">
                        <h3 style="margin:0px;"><label class="label label-warning">+Toyを登録する</label></h3>
                    </div>
                </div>
            </a>
            <!-- jQuery JS -->
            <script jsf:library="js" jsf:name="jquery-1.12.4.js"/>
            <script type="text/javascript">
                $(document).ready(function() { 
                    // 現在選択中のToyにマーカを付ける
                    $("#toy-item-#{sessionBean.selectedToyId}").addClass("toy-selected");
                    
                    $("#toy-item-register").hover(
                        function(){
                            // マウスホバー時の処理(背景色の変更, 枠線の変更)
                           $(this).css("background-color","#d4d4d4");
                        },
                        function(){
                            // マウスブラー時の処理
                           $(this).css("background-color","");
                        }
                    );
                }); 
                
            </script>
        </ui:composition>
    </body>
</html>
