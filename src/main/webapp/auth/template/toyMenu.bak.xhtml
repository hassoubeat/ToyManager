<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:jsf="http://xmlns.jcp.org/jsf">
    <body>
        <ui:composition>
            <ui:repeat var="item" value="#{toyMenuBean.toyList}" varStatus="status">
                <div class="panel panel-primary" id="toy-item-#{item.id}" style="margin-right: -15px; margin-bottom: 1px;">
                    <div class="panel-heading">
                        Toy_#{status.index}
                        <div class="pull-right"><span class="glyphicon glyphicon-trash"/></div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <img class="thumnail_50" src="http://localhost:8080/ToyManager/resources/img/toymanager.png" style="margin-left: 5px;"/>
<!--                            <img class="thumnail_50" src="#{item.pictureUrl}" style="margin-left: 5px;"/>-->
                            <b>#{item.name}</b>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>最後の同期時刻</th>
                                    <th>同期状態</th>
                                </tr>
                            </thead>
                            <tbody class="text-center">
                                <tr>
                                    <td>
                                        <h:outputText class="label label-default" value="#{item.lastSyncDate}" >
                                            <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
                                        </h:outputText>
                                    </td>
                                    <td>
                                        <ui:fragment  rendered="#{item.diffSyncEventList.size() == 0}">
                                            <label class="label label-success">
                                                <!-- 未同期のイベントが存在しない場合 -->
                                                sync
                                            </label>
                                        </ui:fragment>
                                        <ui:fragment  rendered="#{item.diffSyncEventList.size() > 0}">
                                            <label class="label label-danger">
                                                <!-- 未同期のイベントが一件以上存在した場合 -->
                                                unsync
                                            </label>
                                        </ui:fragment>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <a class="btn btn-primary" jsf:outcome="/auth/toy/status">ステータス</a>
                        <form jsf:id="toy-select-form" id="toy-select-form-#{item.id}">
                            <button id="select-toy-#{item.id}" jsf:action="#{toyMenuBean.selectToy(item.id)}" style=""/>
                        </form>

                    </div>
                </div>
            </ui:repeat>
            
            <a jsf:outcome="/auth/toy/create" style="text-decoration:none;">
                <div class="panel panel-default" id="toy-item-register" style="margin-right: -15px; margin-bottom: 1px;">
                    <div class="panel-body" style="border-color: #585858; border-style: dotted; text-align: center;">
                        <h3 style="margin:0px;"><label class="label label-warning">+Toyを登録する</label></h3>
                    </div>
                </div>
            </a>
            <!-- jQuery JS -->
            <script jsf:library="js" jsf:name="jquery-1.12.4.js"/>
            <script type="text/javascript">
                
                $(window).load(function () {
                    
                    // 現在選択中のToyにマーカを付ける
//                    $("[id^=toy]").removeClass("toy-selected");
                    $("toy-item-#{sessionBean.selectedToyId}").addClass("toy-selected");
                    
                    $("[id^=toy-item]").hover(
                        function(){
                            // マウスホバー時の処理(背景色の変更, 枠線の変更)
                           $(this).css("background-color","#d4d4d4");
                        },
                        function(){
                            // マウスブラー時の処理
                           $(this).css("background-color","");
                        }
                    );

                    $("[id^=toy-item]").click(function(){
                        // 選択した要素のidからToyIdのみを切り出す
                        var strList = $(this).attr("id").split("-");
                        var toyId = strList[strList.length - 1];
                        
                        console.log("toyId" + toyId);
                        
                        // ToyId選択処理を行う
//                        $("#select-toy-" + toyId).click();
                        $("#toy-select-form-" + toyId).submit();
                        // toy-select-form-
                        
//                        // 選択した要素のclassに.toy-selectedを付与する
//                        $(this).addClass("toy-selected");
                        
                        
                        
                        // toy-menuを有効化する
//                        $("#toy-menu-select-alert").hide();
//                        $("#toy-menu-selected-item").removeClass("hide");
//                        $("[id^=toy-menu").removeClass("disabled");
//                        $("[id^=toy-menu").children().removeClass("unselected");
                    });

                });
            </script>
        </ui:composition>
    </body>
</html>
